#!/usr/bin/env python
import sys
sys.path.append('/usr/lib/mc-foo/lib/python')

import McFoo.playqueue
import McFoo.dj
import McFoo.inputsong
import McFoo.server.tcp

playqueue = McFoo.playqueue.PlayQueue()
dj = McFoo.dj.Dj()
inputsong = McFoo.inputsong.InputSong(playqueue)

Listen = McFoo.server.tcp.server(dj)
Listen.start_listen()

import asyncore
while 1:
    if dj.isdone():
        next = playqueue.pop()
        if next==None:
            pass
        else:
            dj.set_next(next)
    if len(playqueue) < 100:
    	inputsong.wakeup()
	asyncore.poll(0.001)
    else:
	asyncore.poll(1)
